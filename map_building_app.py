import streamlit as st
import pandas as pd
import folium
from streamlit_folium import st_folium

# νƒ€μ΄ν‹€
st.title('πΆ κ΄‘μ–‘μ‹ λ…Έν›„ κ±΄μ¶•λ¬Ό μ •λ³΄')

# μμ‹ λ°μ΄ν„°
data = {
    'κ±΄λ¬Όλ…': ['κ΄‘μ–‘κ³ λ“±ν•™κµ', 'κ΄‘μ–‘μ£Όνƒ1', 'κ΄‘μ–‘μƒκ°€2', 'κ΄‘μ–‘μ λΉλΌ', 'κ΄‘μ–‘μ μƒκ°€1', 'κ΄‘μ–‘μ μ£Όνƒ2'],
    'κ±΄μ¶•λ…„λ„': [1987, 1975, 1980, 1970, 1985, 1990],
    'μ£Όμ†': ['μ „λΌλ‚¨λ„ κ΄‘μ–‘μ‹ λ΄‰κ°•λ©΄ λ§¤μ²λ΅ 667', 'κ΄‘μ–‘μ‹ YYκΈΈ 45', 'κ΄‘μ–‘μ‹ ZZλ΅ 678', 'κ΄‘μ–‘μ AAκΈΈ 89', 'κ΄‘μ–‘μ BBλ΅ 56', 'κ΄‘μ–‘μ CCλ΅ 101'],
    'λ…Έν›„ν™”μ •λ„': ['μ‹¬κ°', 'λ³΄ν†µ', 'μ–‘νΈ', 'μ‹¬κ°', 'λ³΄ν†µ', 'μ–‘νΈ'],
    'λ³΄μν•„μ”': ['μ', 'μ', 'μ•„λ‹μ¤', 'μ', 'μ', 'μ•„λ‹μ¤'],
    'μ„λ„': [34.9836075015558, 34.9700, 34.9740, 34.9760, 34.9780, 34.9800],
    'κ²½λ„': [127.572658384177, 127.5800, 127.5830, 127.5845, 127.5850, 127.5860],
}
df = pd.DataFrame(data)

# μ§€λ„ μƒμ„± (μ¤‘μ‹¬ μ„μΉλ„ κ΄‘μ–‘κ³ λ“±ν•™κµ κ·Όμ²λ΅ μ„¤μ •)
m = folium.Map(location=[34.9836, 127.5726], zoom_start=15)

# μ§€λ„μ— κ±΄λ¬Ό ν‘μ‹
for i, row in df.iterrows():
    folium.Marker(
        location=[row['μ„λ„'], row['κ²½λ„']],
        popup=f"""
        <b>κ±΄λ¬Όλ…:</b> {row['κ±΄λ¬Όλ…']}<br>
        <b>κ±΄μ¶•λ…„λ„:</b> {row['κ±΄μ¶•λ…„λ„']}<br>
        <b>λ…Έν›„ν™” μ •λ„:</b> {row['λ…Έν›„ν™”μ •λ„']}<br>
        <b>λ³΄μ ν•„μ”:</b> {row['λ³΄μν•„μ”']}
        """,
        tooltip=row['κ±΄λ¬Όλ…']
    ).add_to(m)

# Streamlitμ—μ„ Folium μ§€λ„ λ λ”λ§
st_map = st_folium(m, width=700, height=500)

# μ„ νƒν• κ±΄λ¬Ό μ •λ³΄λ¥Ό ν‘μ‹ (PopupμΌλ΅ μ κ³µ)
if st_map.get("last_object_clicked"):
    clicked_info = st_map["last_object_clicked"]
    clicked_building = df[
        (df["μ„λ„"] == clicked_info["lat"]) & (df["κ²½λ„"] == clicked_info["lng"])
    ].iloc[0]
    
    st.subheader(f"{clicked_building['κ±΄λ¬Όλ…']} μƒμ„Έ μ •λ³΄")
    st.write(f"κ±΄μ¶•λ…„λ„: {clicked_building['κ±΄μ¶•λ…„λ„']}")
    st.write(f"μ£Όμ†: {clicked_building['μ£Όμ†']}")
    st.write(f"λ…Έν›„ν™” μ •λ„: {clicked_building['λ…Έν›„ν™”μ •λ„']}")
    st.write(f"λ³΄μ ν•„μ” μ—¬λ¶€: {clicked_building['λ³΄μν•„μ”']}")

    # λ…Έν›„ν™” μ •λ„μ— λ”°λΌ μƒ‰κΉ” ν‘μ‹
    if clicked_building['λ…Έν›„ν™”μ •λ„'] == 'μ‹¬κ°':
        st.error('β οΈ λ…Έν›„ν™” μƒνƒκ°€ λ§¤μ° μ‹¬κ°ν•©λ‹λ‹¤.')
    elif clicked_building['λ…Έν›„ν™”μ •λ„'] == 'λ³΄ν†µ':
        st.warning('β οΈ λ…Έν›„ν™” μƒνƒκ°€ λ³΄ν†µμ…λ‹λ‹¤.')
    else:
        st.success('π λ…Έν›„ν™” μƒνƒκ°€ μ–‘νΈν•©λ‹λ‹¤.')